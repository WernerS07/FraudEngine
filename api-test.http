// HOW TO USE
// Issue tokens for basic user and the higher priv user
// Higher priv is needed to start mock data at bottom of file
// Both higher priv and basic user can call all the fraud endpoints. 
// Data can be retrieved with pagination based on record ID, account ID, recipient account ID, location, or category.
// Records can also be updated as not fraudulent by using the ApproveRecord endpoint with the record ID. After auditing was performed
// One xss is included to show path traversal is not possible to access higher priv routes with basic token.
// Client secrets are example secrets imported during keycloak startup. IN production these would be stored securely in vault and not hardcoded.
// All passwords are the same, for demo purposes only. In production, passwords would never be hardcoded. 

@Gateway_HostAddress = http://localhost:80
@KEYCLOAK =http://localhost:8080
@CLIENT_ID =fraud-engine
@CLIENT_SECRET = We9mZUVpjm8bFg8FDePdYYvYgDO9pbND
@BASIC_TOKEN= eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJrN2pPaVZkSFE0alBOem1zSlg3bDdDa2RHV1VwNmVKLVlyd3VodTNVc3ZNIn0.eyJleHAiOjE3NzE1Njg2NDIsImlhdCI6MTc3MTU2ODM0MiwianRpIjoiOTJkYmNkMGItMjNmMS00OWYyLThkN2YtNDVkYTVkNTYzMDE1IiwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL3JlYWxtcy9mcmF1ZC1lbmdpbmUiLCJhdWQiOlsiZnJhdWQtZW5naW5lIiwiYWNjb3VudCJdLCJzdWIiOiI1OGI3N2JhMy0xMTgzLTQ2Y2MtYWRjZC01ZmM2M2E4NGM3MjciLCJ0eXAiOiJCZWFyZXIiLCJhenAiOiJmcmF1ZC1lbmdpbmUiLCJzZXNzaW9uX3N0YXRlIjoiNjNmY2ZlNDMtZTYxYi00ZTZmLWE4M2EtNDQ0MzIwYWQzYjNkIiwiYWNyIjoiMSIsImFsbG93ZWQtb3JpZ2lucyI6WyIvKiJdLCJyZXNvdXJjZV9hY2Nlc3MiOnsiYWNjb3VudCI6eyJyb2xlcyI6WyJtYW5hZ2UtYWNjb3VudCIsIm1hbmFnZS1hY2NvdW50LWxpbmtzIiwidmlldy1wcm9maWxlIl19fSwic2NvcGUiOiJwcm9maWxlIGVtYWlsIGZyYXVkLWVuZ2luZS1hdWRpZW5jZSIsInNpZCI6IjYzZmNmZTQzLWU2MWItNGU2Zi1hODNhLTQ0NDMyMGFkM2IzZCIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJyb2xlIjpbImJhc2ljLXJvbGUiLCJvZmZsaW5lX2FjY2VzcyIsImRlZmF1bHQtcm9sZXMtZnJhdWQtZW5naW5lIiwidW1hX2F1dGhvcml6YXRpb24iXSwicHJlZmVycmVkX3VzZXJuYW1lIjoiYmFzaWNwcml2In0.M7LOm_1iR-N_k-8CDDRi-hHrdh3ztFiQNWUirVHW3q8nzCwVCBXng--R0nvqJETWvgeO1J8rV1EoV5EOwvOOs55m4d6rQ8cAlMEDaOlHQdpRxEZKDj8lh4ddT9WeBMD8ta1OK31Ys_9j0Xn7JxKhiEiL0PNCPnj5vMSiOpTr7WCHqNKQZwuAfWQjI8XnT8HEq1zwywwwhdPmI6GtEjscKT8c1nctGsYBqNhWGhPFVuw1A42BhTCPP6HMuT3nKnSL02sjrGhztXEtx3uafVzbF8a2LAXo9jpFaaVpfU444jCr8EwrvqJPHGHXyglLABMcT0GzVqX6UhLnwVYhBOVjfA
@HIGHERPRIV_TOKEN = eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJrN2pPaVZkSFE0alBOem1zSlg3bDdDa2RHV1VwNmVKLVlyd3VodTNVc3ZNIn0.eyJleHAiOjE3NzE1NzY5MjMsImlhdCI6MTc3MTU3NjYyMywianRpIjoiZWVhMGIzYTYtMDI5My00ZGUwLTgyNWQtNDgwZTYzYzA0OGFiIiwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL3JlYWxtcy9mcmF1ZC1lbmdpbmUiLCJhdWQiOlsiZnJhdWQtZW5naW5lIiwiYWNjb3VudCJdLCJzdWIiOiI5NWY1YzEwZi1hYjQ2LTRiYWUtODAyNS02NmQ5NTdjNmZlOTQiLCJ0eXAiOiJCZWFyZXIiLCJhenAiOiJmcmF1ZC1lbmdpbmUiLCJzZXNzaW9uX3N0YXRlIjoiNGUwMDNhMWQtMmE0NS00OGI1LWE5YWYtMmZjZDU5ZmQ3MTQwIiwiYWNyIjoiMSIsImFsbG93ZWQtb3JpZ2lucyI6WyIvKiJdLCJyZXNvdXJjZV9hY2Nlc3MiOnsiYWNjb3VudCI6eyJyb2xlcyI6WyJtYW5hZ2UtYWNjb3VudCIsIm1hbmFnZS1hY2NvdW50LWxpbmtzIiwidmlldy1wcm9maWxlIl19fSwic2NvcGUiOiJwcm9maWxlIGVtYWlsIGZyYXVkLWVuZ2luZS1hdWRpZW5jZSIsInNpZCI6IjRlMDAzYTFkLTJhNDUtNDhiNS1hOWFmLTJmY2Q1OWZkNzE0MCIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJyb2xlIjpbImJhc2ljLXJvbGUiLCJvZmZsaW5lX2FjY2VzcyIsImhpZ2hlci1wcml2LXJvbGUiLCJkZWZhdWx0LXJvbGVzLWZyYXVkLWVuZ2luZSIsInVtYV9hdXRob3JpemF0aW9uIl0sInByZWZlcnJlZF91c2VybmFtZSI6ImhpZ2hlcnByaXYifQ.zDl1MOBq334G1IcrgciHm2nmslJvcsgJHPJ9jSSKGBBy3hzrWCpvqd3nDihp4PDA8kV6LnsCJlaix1Qnw7Ik78anlpGbw9b261Pur064ni7VLW_hU4fjp7O0MAVpoLpdwkCX5S8ih6VLYXnnJ4NbEFY7ISS0HmQ_7Jd-eqZLloBLzFF0cdYsk74BjZjWZuyhj6M62Wbno8VaQsb2pb196GiYFn-bajpl49q_jXscsjATZQxYVPxPc-ehTpLhqbNhbOWLn897oY-TR3ZrB8-58DjWVQqQQT0oapqGlPwYvSyehw55ERz48pRmE7nozL8nvpaCGqgPueuy4vQIOMJs-Q
### Get Basic user token (password grant)
POST http://localhost:8080/realms/fraud-engine/protocol/openid-connect/token
Content-Type: application/x-www-form-urlencoded

grant_type=password&client_id=fraud-engine&client_secret=JyMbhzGzdgWUG2LetPXT20IXOXFtTAU1&username=basicpriv&password=basicpriv

### Get higher priv token (password grant)
POST {{KEYCLOAK}}/realms/fraud-engine/protocol/openid-connect/token
Content-Type: application/x-www-form-urlencoded

grant_type=password&client_id=fraud-engine&client_secret=JyMbhzGzdgWUG2LetPXT20IXOXFtTAU1&username=higherpriv&password=higherpriv

###
# Replace {{BASIC_TOKEN}} / {{HIGHERPRIV_TOKEN}} with access_token values from the responses

### Call Basic endpoint (allowed for basic user or auditor)
GET http://localhost/fraud/Record?page=1
Authorization: Bearer {{BASIC_TOKEN}}
Accept: text/plain

### Auditor get records
GET http://localhost/fraud/Record/?page=94000
Authorization: Bearer {{HIGHERPRIV_TOKEN}}
Accept: text/plain

### Higher Priv get records
GET http://localhost/fraud/Record/FraudCheck/?page=3701
Authorization: Bearer {{HIGHERPRIV_TOKEN}}
Accept: text/plain


###
# UPDATE A RECORD ID TO MARK IT AS NOT FRAUDULENT
PUT http://localhost/fraud/Record/ApproveRecord/182
Content-Type: application/json
Authorization: Bearer {{HIGHERPRIV_TOKEN}}

### GET ALL TRANSACTION FOR AN ACCOUNT
GET http://localhost/fraud/Record/Account/1862?limit=5
Authorization: Bearer {{HIGHERPRIV_TOKEN}}
Accept: text/plain


### GET ALL TRANSACTIONS BY LOCATION
GET http://localhost/fraud/Record/Location/Russia
Authorization: Bearer {{HIGHERPRIV_TOKEN}}
Accept: text/plain

### GET ALL TRANSACTIONS BY RECIPIENT ACCOUNT ID
GET http://localhost/fraud/Record/Recipient/10399
Authorization: Bearer {{HIGHERPRIV_TOKEN}}
Accept: text/plain

### GET ALL TRANSACTIONS BY CATEGORY 
#Groceries, Electronics, Clothing, Travel, Dining, Entertainment, Health, Utilities, Education, Automotive
GET http://localhost/fraud/Record/Category/Automotive?page=200
Authorization: Bearer {{HIGHERPRIV_TOKEN}}
Accept: text/plain

### XSS Test with basic user trying to access higher priv route
GET http://localhost/fraud/../mockdata/status
Authorization: Bearer {{BASIC_TOKEN}}
Accept: text/plain

### Proxied to mock data
GET {{Gateway_HostAddress}}/mockdata/status
Authorization: Bearer {{HIGHERPRIV_TOKEN}}
Accept: application/json

### Proxied to mock data
POST {{Gateway_HostAddress}}/mockdata/toggle?state=true 
Authorization: Bearer {{HIGHERPRIV_TOKEN}}
Accept: application/json

### Proxied to mock data
POST {{Gateway_HostAddress}}/mockdata/toggle?state=false
Authorization: Bearer {{HIGHERPRIV_TOKEN}}
Accept: application/json
